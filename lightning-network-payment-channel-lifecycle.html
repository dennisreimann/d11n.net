<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="keywords" content="Bitcoin,Lightning Network"/><meta name="description" content="The Lightning Network is a second layer scaling solution for Bitcoin and similar cryptocurrencies.
This post shows the lifecycle of a Lightning Network payment channel.
"/><meta name="theme-color" content="#0d151e"/><meta name="lightning" content="lnurlp:donate@d11n.net"/><meta name="msapplication-TileColor" content="#0d151e"/><meta name="msapplication-config" content="/browserconfig.xml"/><meta property="twitter:creator" content="@dennisreimann"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:title" content="The Payment Channel Lifecycle · d11n 🍯🦡⚡️🕗🔗"/><meta property="twitter:description" content="The Lightning Network is a second layer scaling solution for Bitcoin and similar cryptocurrencies.
This post shows the lifecycle of a Lightning Network payment channel.
"/><meta property="twitter:image" content="https://d11n.net/images/lightning-network/commitment-transaction-2.png"/><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"/><link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#0d151e"/><link rel="stylesheet" href="/styles/main.css"/><link rel="manifest" href="/site.webmanifest"/><title>The Payment Channel Lifecycle · d11n 🍯🦡⚡️🕗🔗</title></head><body><header class="header"><div class="wrap"><a class="home" href="/"><svg viewbox="0 0 423 369" xmlns="http://www.w3.org/2000/svg" class="logo">
  <g fill-rule="nonzero" fill="none">
    <path d="M225.233 70.6l-51.9 297.4h-45.6L179.63 70.6h45.603zm82-70l-51.9 297.4h-45.6L261.63.6h45.603z" class="accent" />
    <path d="M422.2 174c0 3.8-.25 8.1-.75 12.9-.5 4.8-1.25 9.6-2.25 14.4L402.7 297h-43.8l16.8-95.7c.4-1.8.7-3.65.9-5.55.2-1.9.3-3.75.3-5.55 0-4.2-.85-7.8-2.55-10.8-1.7-3-4.95-4.5-9.75-4.5-6 0-11.15 2.85-15.45 8.55-4.3 5.7-7.25 13.05-8.85 22.05L324.4 297h-43.8l20.7-117.9 1.5-9.15c.6-3.7 1.15-7.4 1.65-11.1.444-3.289.889-6.38 1.333-9.274l.478-3.106c.337-2.247.583-4.07.739-5.47h41.4l-.204 1.463c-.278 2.033-.578 4.4-.9 7.1l-.246 2.087c-.5 4.3-1.05 8.35-1.65 12.15h.6c4-7.8 9.5-14.35 16.5-19.65 7-5.3 15.3-7.95 24.9-7.95 6.2 0 11.55 1.15 16.05 3.45 4.5 2.3 8.1 5.25 10.8 8.85 2.7 3.6 4.7 7.65 6 12.15 1.3 4.5 1.95 8.95 1.95 13.35zM155.1 70.2L115.5 297H73.8l3.3-20.1h-.3c-3.6 7-8.2 12.9-13.8 17.7-5.6 4.8-13.1 7.2-22.5 7.2-6.8 0-12.75-1.4-17.85-4.2-5.1-2.8-9.3-6.65-12.6-11.55-3.3-4.9-5.8-10.8-7.5-17.7C.85 261.45 0 253.9 0 245.7c0-12.2 1.45-24.75 4.35-37.65 2.9-12.9 7.2-24.7 12.9-35.4S29.9 153.2 38.1 146.4c8.2-6.8 17.7-10.2 28.5-10.2 9 0 15.8 2.05 20.4 6.15 4.6 4.1 7.5 9.45 8.7 16.05h.9l15.6-88.2h42.9zM74.4 173.7c-5.2 0-9.7 2.2-13.5 6.6-3.8 4.4-7 9.85-9.6 16.35-2.6 6.5-4.55 13.5-5.85 21-1.3 7.5-1.95 14.35-1.95 20.55 0 7.6 1.25 13.8 3.75 18.6 2.5 4.8 6.65 7.2 12.45 7.2 4.8 0 9.1-2.15 12.9-6.45 3.8-4.3 7-9.65 9.6-16.05 2.6-6.4 4.6-13.3 6-20.7 1.4-7.4 2.1-14.1 2.1-20.1 0-8-1.25-14.5-3.75-19.5s-6.55-7.5-12.15-7.5z" class="color" />
  </g>
</svg>
</a></div></header><main class="main"><div class="wrap"><div class="article lightning-network-payment-channel-lifecycle"><h1 id="the-payment-channel-lifecycle" tabindex="-1"><a class="header-anchor" href="#the-payment-channel-lifecycle">#</a> The Payment Channel Lifecycle</h1>
<h2 id="lightning-network-explained" tabindex="-1"><a class="header-anchor" href="#lightning-network-explained">#</a> Lightning Network explained</h2>
<p>The Lightning Network is a second layer scaling solution for Bitcoin and similar cryptocurrencies.
It promises faster transactions and lower fees, enabled by a network of bidirectional payment channels.
This post shows the lifecycle of a Lightning Network payment channel.</p>
<p>It all starts out by “branching off the blockchain into the Lightning Network” by funding a payment channel.
A high-level overview looks like this:</p>
<figure><a href="/images/lightning-network/payment-channel-lifecycle.png"><img src="/images/lightning-network/payment-channel-lifecycle.png" alt=""></a><figcaption>Lifecycle of a Lightning Network payment channel</figcaption></figure>
<p>Let’s zoom in …</p>
<h2 id="the-funding-transaction" tabindex="-1"><a class="header-anchor" href="#the-funding-transaction">#</a> The funding transaction</h2>
<p><mark>The funding transaction creates a multisignature wallet and signs three transactions but only broadcasts one to the blockchain.</mark>
The remaining two are the <em>Commitment Transactions</em> each peer holds.
After sufficient block confirmations the channel is considered open.</p>
<figure><a href="/images/lightning-network/funding-transaction.png"><img src="/images/lightning-network/funding-transaction.png" alt=""></a><figcaption>Funding transaction</figcaption></figure>
<p>The commitment transactions can be thought of as “balance sheets”, that will be for later use in a channel closing transaction.
Each peer holds a secret used to generate a hash for his commitment transaction.</p>
<p>Note: Right now, only a single party can commit funds for opening a new channel.
Future versions of the <a href="https://github.com/lightningnetwork/lightning-rfc">Lightning Network specification</a> will allow for dual-funded payment channels.</p>
<h2 id="commitment-transactions" tabindex="-1"><a class="header-anchor" href="#commitment-transactions">#</a> Commitment Transactions</h2>
<p>Bob sends Alice an invoice about 4 mBTC, which she pays.
<mark>This exchanges the current transaction hash and previous secret, also called the <em>revocation key</em>.</mark>
Each new commitment transaction invalidates old ones as the secret can be used to revoke them.</p>
<figure><a href="/images/lightning-network/commitment-transaction-1.png"><img src="/images/lightning-network/commitment-transaction-1.png" alt=""></a><figcaption>Commitment transaction nr. 1: Exchanges current hash and previous secret.</figcaption></figure>
<p>After the first fund-exchanging commitment transaction, Alice’s state says:</p>
<ul>
<li>4 mBTC for Bob and</li>
<li>either: 6 mBTC for Alice after 1000 blocks</li>
<li>or: 6 mBTC for Bob if he knows Alice’s secret</li>
</ul>
<p>Bob’s commitment transaction is the exact counterpart to Alice’s state:</p>
<ul>
<li>6 mBTC for Alice and</li>
<li>either: 4 mBTC for Bob after 1000 blocks</li>
<li>or: 4 mBTC for Alice if she knows Bob’s secret</li>
</ul>
<p>This is fun – let’s transact once more and see what this seemingly magical <em>1000 block waiting period</em> (roughly 7 days) is about!</p>
<figure><a href="/images/lightning-network/commitment-transaction-2.png"><img src="/images/lightning-network/commitment-transaction-2.png" alt=""></a><figcaption>Commitment transaction nr. 2: Exchanges current hash and previous secret.</figcaption></figure>
<p>Afterwards Alice’s state says:</p>
<ul>
<li>8 mBTC for Bob and</li>
<li>either: 2 mBTC for Alice after 1000 blocks</li>
<li>or: 2 mBTC for Bob if he knows Alice’s secret</li>
</ul>
<p>The 1000 block wait time becomes important when closing a payment channel …</p>
<h2 id="closing-a-payment-channel" tabindex="-1"><a class="header-anchor" href="#closing-a-payment-channel">#</a> Closing a payment channel</h2>
<p>There are multiple possibilities of how a payment channel in the Lightning Network can be closed.
Let’s start with the simplest and usual way …</p>
<h3 id="mutual-channel-close" tabindex="-1"><a class="header-anchor" href="#mutual-channel-close">#</a> Mutual channel close</h3>
<p>This is the best case scenario:
<mark>A cooperative close initiated by both peers broadcasting their current commitment transactions happens immediately.</mark>
The multisignature wallet spends the funds back on-chain and both peers should be happy.</p>
<figure><a href="/images/lightning-network/closing-transaction-mutual.png"><img src="/images/lightning-network/closing-transaction-mutual.png" alt=""></a><figcaption>Mutual closing of a payment channel: Alice and Bob broadcast their current commitments.</figcaption></figure>
<h3 id="force-closing-a-channel" tabindex="-1"><a class="header-anchor" href="#force-closing-a-channel">#</a> Force closing a channel</h3>
<p>Let’s say Alice disappears and Bob has to unilaterally close to get his funds on-chain.
In this case he has to undergo the 1000 block wait time (~7 days), which gives Alice the chance to come back and maybe revoke to this.</p>
<figure><a href="/images/lightning-network/closing-transaction-forced.png"><img src="/images/lightning-network/closing-transaction-forced.png" alt=""></a><figcaption>Forced closing of a payment channel: Bob broadcasts his current commitment.</figcaption></figure>
<p>Speaking of …</p>
<h3 id="what-happens-in-case-of-a-false-close%3F" tabindex="-1"><a class="header-anchor" href="#what-happens-in-case-of-a-false-close%3F">#</a> What happens in case of a false close?</h3>
<p>Let’s say Alice broadcasts an outdated state that favors her.
This might be intended (pretty mean, that’s what we call fraud) or accidentally (having an incorrect channel state, restored from backup).</p>
<figure><a href="/images/lightning-network/closing-transaction-false.png"><img src="/images/lightning-network/closing-transaction-false.png" alt=""></a><figcaption>False close of a payment channel: Alice broadcasts an outdated commitment.</figcaption></figure>
<p>The 1000 block wait time gives Bob the chance to remedy the breach:
He knows and reveals the secret/revocation key for Alice’s outdated transaction.
Alice will suffer a harsh punishment as discovering the fraud attempt results in a complete seizure of funds.
10 mBTC go to Bob!</p>
<figure><a href="/images/lightning-network/closing-transaction-remedy.png"><img src="/images/lightning-network/closing-transaction-remedy.png" alt=""></a><figcaption>Breach remedy of a false closing transaction: Bob knows the secret for Alice’s outdated commitment.</figcaption></figure>
<p>Alright, that’s the shortest version of an explanation I can think of.
Hope I explained this well enough and the diagrams make it approachable even for not too technical people.
On the other side I also hope it doesn’t oversimplify too much of the concepts.</p>
</div><h4>Liked this article?</h4>
<p>Say <em>thanks</em> with some sats <a href="lightning:LNURL1DP68GURN8GHJ7AMPD3KX2AR0VEEKZAR0WD5XJTNRDAKJ7TNHV4KXCTTTDEHHWM30D3H82UNVWQHKXUN0WAJX2ER9V9E8G6PN8QSKVTEZ">via Lightning</a>.</p>
<a href="lightning:LNURL1DP68GURN8GHJ7AMPD3KX2AR0VEEKZAR0WD5XJTNRDAKJ7TNHV4KXCTTTDEHHWM30D3H82UNVWQHKXUN0WAJX2ER9V9E8G6PN8QSKVTEZ">
<img src="/lnurl.png" alt="LNURL1DP68GURN8GHJ7AMPD3KX2AR0VEEKZAR0WD5XJTNRDAKJ7TNHV4KXCTTTDEHHWM30D3H82UNVWQHKXUN0WAJX2ER9V9E8G6PN8QSKVTEZ" style="width:256px;">
</a></div></main><footer class="footer"><div class="wrap"><p>Follow  <a href="/about.html">me</a> on <a href="https://twitter.com/_d11n_">Twitter</a> or <a href="https://github.com/dennisreimann">GitHub</a>.</p></div><div class="wrap"><p>Published at block height <time datetime="2019-05-06">574853</time>. <a href="https://github.com/dennisreimann/d11n.net/blob/master/articles/574853-lightning-network-payment-channel-lifecycle.md">(GitHub)</a></p><p>Website last updated at block height <time datetime="2023-04-29">787493</time>.</p></div></footer></body></html>